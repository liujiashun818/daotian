(function(){"use strict";var e=this,t=this,n=function(e,n,a){function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,n){if(!(e instanceof n))throw new t.TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new t.ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new t.TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=t.Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(t.Object.setPrototypeOf?t.Object.setPrototypeOf(e,n):e.__proto__=n)}t.Object.defineProperty(n,"__esModule",{value:!0});var i=(a(47),a(41)),r=_interopRequireDefault(i),s=(a(49),a(48)),u=_interopRequireDefault(s),l=(a(51),a(50)),o=_interopRequireDefault(l),c=(a(633),a(199)),f=_interopRequireDefault(c),d=(a(66),a(65)),m=_interopRequireDefault(d),p=(a(630),a(318)),h=_interopRequireDefault(p),y=function(){function defineProperties(e,n){for(var a=0;a<n.length;a++){var i=n[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),t.Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),_=a(0),v=_interopRequireDefault(_),b=a(22),k=_interopRequireDefault(b),E=h.default.Group,g=function(e){function System(e){_classCallCheck(this,System);var n=_possibleConstructorReturn(this,(System.__proto__||t.Object.getPrototypeOf(System)).call(this,e));return n.state={systemTypes:[{_id:1,name:"基础版"},{_id:2,name:"标准版"},{_id:3,name:"高级版"},{_id:4,name:"MC版"},{_id:5,name:"销售版"},{_id:6,name:"基础版+销售版"},{_id:7,name:"标准版+销售版"},{_id:8,name:"高级版+销售版"},{_id:9,name:"MC版+销售版"}],permissionMap:new t.Map,typeId:""},["handleSubmit","handleRadioChange","handleCheckboxChange"].map(function(e){return n[e]=n[e].bind(n)}),n}return _inherits(System,e),y(System,[{key:"componentDidMount",value:function(){this.getPermissions("0")}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.typeId,a=t.permissionMap;if(!n)return m.default.warning("请先选择系统版本"),!1;var i=this.assembleCheckedIds(a);k.default.ajax({url:k.default.admin.permission.updateBySystem(),type:"post",data:{system_type:n,item_ids:i.toString()}},function(){m.default.success("设置成功")},function(e){m.default.error("设置失败["+e+"]")})}},{key:"handleRadioChange",value:function(e){var t=e.target.value;this.setState({typeId:t}),this.getSystemPermissions(t)}},{key:"handleCheckboxChange",value:function(e,t){var n=t.target.checked,a=this.state.permissionMap,i=a.get(e.parent_id),r=i.items;e.checked=n,r.set(e._id,e),i.items=r,a.set(e.parent_id,i),this.setState({permissionMap:a})}},{key:"getSystemPermissions",value:function(e){var t=this;k.default.ajax({url:k.default.admin.permission.getBySystem(e)},function(e){var n=e.res.list,a=t.state.permissionMap;a.forEach(function(e){var t=e.items;t&&t.size>0&&(t.forEach(function(e){e.checked=!1,t.set(e._id,e)}),n.map(function(e){var n=t.get(e.item_id);n&&(n.checked=!0,t.set(n._id,n))})),e.items=t,a.set(e._id,e)}),t.setState({permissionMap:a})})}},{key:"getPermissions",value:function(e){var n=this;k.default.ajax({url:k.default.admin.permission.list(e)},function(a){var i=a.res.list,r=n.state.permissionMap;i.length>0&&("0"===t.String(e)?i.forEach(function(e){r.set(e._id,e),n.getPermissions(e._id)}):r.forEach(function(n){if(n._id===e){var a=r.get(e),s=new t.Map;i.forEach(function(e){e.checked=!1,s.set(e._id,e)}),a.items=s,r.set(e,a)}}),n.setState({permissionMap:r}))})}},{key:"assembleCheckedIds",value:function(e){var t=[];return e.forEach(function(e){var n=e.items;n&&n.size>0&&n.forEach(function(e){return e.checked&&t.push(e._id)})}),t}},{key:"renderPermission",value:function(e){var n=this,a=[];return 0===e.size?null:(e.forEach(function(e){a.push(v.default.createElement("div",{className:"mb15",key:e._id},v.default.createElement("h4",{className:"mt10 mb10"},e.name),v.default.createElement(u.default,null,e.items&&e.items.size>0&&t.Array.from(e.items.values()).map(function(e){return v.default.createElement(o.default,{span:4},v.default.createElement(f.default,{checked:e.checked,onChange:n.handleCheckboxChange.bind(n,e),key:e._id},e.name))}))))}),a)}},{key:"render",value:function(){var e=this.state,t=e.systemTypes,n=e.permissionMap,a={display:"block",height:"36px",lineHeight:"36px"};return v.default.createElement("div",null,v.default.createElement(u.default,{className:"head-action-bar-line-sm"},v.default.createElement(o.default,{span:4},v.default.createElement("h3",{className:"action-title"},"系统类型")),v.default.createElement(o.default,{span:18},v.default.createElement("h3",{className:"action-title"},"功能")),v.default.createElement(o.default,{span:2},v.default.createElement("div",{className:"pull-right"},v.default.createElement(r.default,{type:"primary",onClick:this.handleSubmit},"保存")))),v.default.createElement(u.default,null,v.default.createElement(o.default,{span:4},v.default.createElement("div",{style:{minWidth:200}},v.default.createElement(E,{onChange:this.handleRadioChange},t.map(function(e){return v.default.createElement(h.default,{value:e._id,style:a,key:e._id},e.name)})))),v.default.createElement(o.default,{span:20},this.renderPermission(n))))}}]),System}(v.default.Component);n.default=g},a=e,i=a.webpackJsonp;if(a.webpackJsonp!==i)throw new Error("Prepack model invariant violation: "+a.webpackJsonp);var r=[64],s={1577:n};i(r,s)}).call(this);