(function(){"use strict";var e=this,t=this,a=function(e,a,r){t.Object.defineProperty(a,"__esModule",{value:!0});var n={aftersales:{project:{destroy:"aftersales/project/destroy"},consumptiveMaterial:{examine:"aftersales/consumptive-material/examine"}},warehouse:{purchase:{import:"warehouse/purchase/import",pay:"warehouse/purchase/pay"},purchaseReject:{export:"warehouse/purchase-reject/export",pay:"warehouse/purchase-reject/pay"},stocktaking:{auth:"warehouse/stocktaking/auth",authorize:"warehouse/stocktaking/authorize",import:"warehouse/stocktaking/import"},supplier:{pay:"warehouse/supplier/pay"}},customer:{information:"customer/customer-information",auto:"customer/auto-information",insurance:"customer/insurance-information",deal:"customer/deal-information",maintenance:"customer/maintenance-information",intention:"customer/intention-information",reminder:"customer/reminder"},deal:{calculatedReturn:"presales/deal-auto/calculation-income"},maintainItem:{commission:"maintain-item/commission"},marketing:{commission:"\tmarketing/membercard/commission"}};a.default=n},r=function(e,a,r){function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var a=e.apply(this,arguments);return new t.Promise(function(e,r){function step(n,l){try{var u=a[n](l),i=u.value}catch(e){return void r(e)}if(!u.done)return t.Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}return step("next")})}}function _classCallCheck(e,a){if(!(e instanceof a))throw new t.TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,a){if(!e)throw new t.ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new t.TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=t.Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(t.Object.setPrototypeOf?t.Object.setPrototypeOf(e,a):e.__proto__=a)}t.Object.defineProperty(a,"__esModule",{value:!0});var n=(r(312),r(311)),l=_interopRequireDefault(n),u=(r(49),r(48)),i=_interopRequireDefault(u),o=(r(51),r(50)),c=_interopRequireDefault(o),s=(r(157),r(35)),f=_interopRequireDefault(s),d=(r(47),r(41)),p=_interopRequireDefault(d),m=(r(66),r(65)),h=_interopRequireDefault(m),y=(r(158),r(131)),_=_interopRequireDefault(y),v=(r(68),r(67)),b=_interopRequireDefault(v),E=t.Object.assign||function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var n in r)t.Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g=function(){function defineProperties(e,a){for(var r=0;r<a.length;r++){var n=a[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),t.Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),w=r(0),k=_interopRequireDefault(w),j=r(635),P=_interopRequireDefault(j),R=r(22),D=_interopRequireDefault(R),x=r(1615),C=_interopRequireDefault(x),O=r(114),q=_interopRequireDefault(O),I=r(313),S=_interopRequireDefault(I),N=b.default.Item,T=_.default.Option,M=function(e){function AuthPay(e){_classCallCheck(this,AuthPay);var a=_possibleConstructorReturn(this,(AuthPay.__proto__||t.Object.getPrototypeOf(AuthPay)).call(this,e));return a.state={detail:e.detail||{}},a.handleShow=a.handleShow.bind(a),a.handleCancel=a.handleCancel.bind(a),a.handlePay=a.handlePay.bind(a),a}return _inherits(AuthPay,e),g(AuthPay,[{key:"componentWillUnmount",value:function(){t.clearInterval(this.interval)}},{key:"handleShow",value:function(){var e=this.props.detail;if("1"!==t.String(e.status))return void h.default.error("请先入库采购单，再结算");this.checkPermission(C.default.warehouse.purchaseReject.pay),this.showModal()}},{key:"handleCancel",value:function(){t.clearInterval(this.interval),this.hideModal()}},{key:"handlePay",value:function(e){e.preventDefault();var a=this.props.form.getFieldsValue();a.reject_id=this.props.id,D.default.ajax({url:D.default.warehouse.reject.pay(),type:"post",data:a},function(e){var a=e.res.detail;"2"===t.String(a.pay_status)&&(h.default.success("支付成功"),t.setTimeout(function(){t.location.href="/warehouse/purchase-reject/index"},500))},function(e){h.default.error(e)})}},{key:"checkPermission",value:function(){function checkPermission(t){return e.apply(this,arguments)}var e=_asyncToGenerator(t.regeneratorRuntime.mark(function _callee(e){var a,r;return t.regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=this.props.id,n.next=3,D.default.checkPermission(e);case 3:r=n.sent,r?this.getRejectDetail(a):this.interval=t.setInterval(this.getRejectDetail.bind(this,a),2e3),this.setState({hasPermission:r});case 6:case"end":return n.stop()}},_callee,this)}));return checkPermission}()},{key:"getRejectDetail",value:function(e){var a=this;D.default.ajax({url:D.default.warehouse.reject.detail(e)},function(e){var r=e.res.detail;a.setState({detail:r}),"2"===t.String(r.pay_status)&&(h.default.success("支付成功"),t.clearInterval(a.interval),t.location.href="/warehouse/purchase-reject/index")})}},{key:"render",value:function(){var e=q.default.formItemTwo,a=q.default.selectStyle,r=this.props,n=r.id,u=r.disabled,o=r.form,s=r.size,d=this.state,m=d.visible,h=d.hasPermission,y=d.detail,v=o.getFieldDecorator,g=o.getFieldValue,w=t.String(y.pay_status);return k.default.createElement("span",null,"small"===s?k.default.createElement("a",{href:"javascript:;",onClick:this.handleShow},"结算"):k.default.createElement(p.default,{type:"primary",onClick:this.handleShow,disabled:u},"结算"),k.default.createElement(l.default,{title:k.default.createElement("span",null,k.default.createElement(f.default,{type:"eye"})," 退货单结算"),visible:m,maskClosable:!1,onCancel:this.handleCancel,footer:h?k.default.createElement("span",null,k.default.createElement(p.default,{size:"large",className:"mr5",onClick:this.handleCancel},"取消"),k.default.createElement(p.default,{size:"large",type:"primary",onClick:this.handlePay},"结算")):null},k.default.createElement(i.default,{type:"flex",align:"middle"},k.default.createElement(c.default,{span:12},k.default.createElement(b.default,null,k.default.createElement(N,E({label:"供应商"},e),k.default.createElement("p",null,y.supplier_company)),k.default.createElement(N,E({label:"退货金额"},e),k.default.createElement("p",null,y.old_worth,"元")),k.default.createElement(N,E({label:"退款金额"},e),k.default.createElement("p",null,y.new_worth,"元")),k.default.createElement(N,E({label:"退款差价"},e),k.default.createElement("p",null,y.diff_worth,"元")),k.default.createElement(N,E({label:"支付方式"},e),v("pay_type",{initialValue:"2"})(k.default.createElement(_.default,a,k.default.createElement(T,{key:"1"},"银行转账"),k.default.createElement(T,{key:"2"},"现金支付")))))),k.default.createElement(c.default,{span:12,className:h?"hide":null},k.default.createElement("div",{className:"center"},k.default.createElement(P.default,{value:t.JSON.stringify({authType:"reject_pay",requestParams:{type:"post",url:D.default.warehouse.reject.pay(),data:{reject_id:n,pay_type:g("pay_type")}}}),size:128,ref:"qrCode"}),k.default.createElement("p",null,"请扫码确认支付"),k.default.createElement("p",null,k.default.createElement(f.default,{type:"check-circle",className:"2"===w?"confirm-check":"hide"})))))))}}]),AuthPay}(S.default);M.defaultProps={size:"default"},M=b.default.create()(M),a.default=M},n=function(e,a,r){function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,a){if(!(e instanceof a))throw new t.TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,a){if(!e)throw new t.ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a}function _inherits(e,a){if("function"!=typeof a&&null!==a)throw new t.TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=t.Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(t.Object.setPrototypeOf?t.Object.setPrototypeOf(e,a):e.__proto__=a)}t.Object.defineProperty(a,"__esModule",{value:!0});var n=(r(49),r(48)),l=_interopRequireDefault(n),u=(r(51),r(50)),i=_interopRequireDefault(u),o=(r(68),r(67)),c=_interopRequireDefault(o),s=t.Object.assign||function(e){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var n in r)t.Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f=function(){function defineProperties(e,a){for(var r=0;r<a.length;r++){var n=a[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),t.Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&defineProperties(e.prototype,t),a&&defineProperties(e,a),e}}(),d=r(0),p=_interopRequireDefault(d),m=r(114),h=_interopRequireDefault(m),y=r(22),_=_interopRequireDefault(y),v=r(198),b=_interopRequireDefault(v),E=r(1826),g=_interopRequireDefault(E),w=c.default.Item,k=function(e){function Detail(e){_classCallCheck(this,Detail);var a=_possibleConstructorReturn(this,(Detail.__proto__||t.Object.getPrototypeOf(Detail)).call(this,e));return a.state={id:e.match.params.id,page:1,detail:{},list:[]},a.handlePageChange=a.handlePageChange.bind(a),a}return _inherits(Detail,e),f(Detail,[{key:"componentDidMount",value:function(){var e=this.state,t=e.id,a=e.page;this.getRejectDetail(t),this.getRejectItems(t,a)}},{key:"handlePageChange",value:function(e){this.setState({page:e}),this.getRejectItems(this.state.id,e)}},{key:"getRejectDetail",value:function(e){var t=this;_.default.ajax({url:_.default.warehouse.reject.detail(e)},function(e){var a=e.res.detail;t.setState({detail:a})})}},{key:"getRejectItems",value:function(e,a){var r=this;_.default.ajax({url:_.default.warehouse.reject.items(e,a)},function(e){var a=e.res,n=a.list,l=a.total;r.setState({list:n,total:t.parseInt(l,10)})})}},{key:"render",value:function(){var e=h.default.formItemThree,a=h.default.formItem12,r=this.state,n=r.page,u=r.detail,o=r.list,f=r.total,d=[{title:"序号",dataIndex:"_id",key:"_id",render:function(e,t,a){return a+1}},{title:"配件分类",dataIndex:"part_type_name",key:"part_type_name"},{title:"配件名",dataIndex:"part_name",key:"part_name"},{title:"配件号",dataIndex:"part_no",key:"part_no"},{title:"适用车型",dataIndex:"scope",key:"scope"},{title:"品牌",dataIndex:"brand",key:"brand"},{title:"退货数量",dataIndex:"amount",key:"amount",className:"center"},{title:"进货单价",dataIndex:"purchase_price",key:"purchase_price",className:"text-right"},{title:"退货单价",dataIndex:"reject_price",key:"reject_price",className:"text-right"},{title:"退货金额",dataIndex:"_id",key:"reject_amount",className:"text-right",render:function(e,a){return t.Number(a.amount*a.reject_price).toFixed(2)}},{title:"差价",dataIndex:"_id",key:"diff_worth",className:"text-right",render:function(e,a){return t.Number((a.purchase_price-a.reject_price)*a.amount).toFixed(2)}}];return p.default.createElement("div",null,p.default.createElement("h4",{className:"mb10"},"基本信息"),p.default.createElement(l.default,null,p.default.createElement(i.default,{span:16},p.default.createElement(c.default,null,p.default.createElement(l.default,null,p.default.createElement(i.default,{span:8},p.default.createElement(w,s({label:"供应商"},e),p.default.createElement("p",null,u.supplier_company))),p.default.createElement(i.default,{span:8},p.default.createElement(w,s({label:"采购金额"},e),p.default.createElement("p",null,u.old_worth," 元"))),p.default.createElement(i.default,{span:8},p.default.createElement(w,s({label:"退货金额"},e),p.default.createElement("p",null,u.new_worth," 元")))),p.default.createElement(l.default,null,p.default.createElement(i.default,{span:8},p.default.createElement(w,s({label:"退款差价"},e),p.default.createElement("p",null,u.diff_worth))),p.default.createElement(i.default,{span:8},p.default.createElement(w,s({label:"运费"},e),p.default.createElement("p",null,u.freight," 元"))),p.default.createElement(i.default,{span:8},p.default.createElement(w,s({label:"物流公司"},e),p.default.createElement("p",null,u.logistics)))),p.default.createElement(l.default,null,p.default.createElement(i.default,{span:12},p.default.createElement(w,s({label:"备注"},a),p.default.createElement("p",null,u.remark)))))),p.default.createElement(i.default,{span:8},"2"===t.String(u.pay_status)||"-1"===t.String(u.status)?null:p.default.createElement("div",{className:"pull-right"},p.default.createElement(g.default,{id:u._id,detail:u})))),p.default.createElement("h4",{className:"mb10"},"配件列表"),p.default.createElement(b.default,{columns:d,dataSource:o,total:f,currentPage:n,onPageChange:this.handlePageChange,footer:function(){return p.default.createElement(l.default,null,p.default.createElement(i.default,{span:24},p.default.createElement("span",{className:"pull-right"},"合计：",u.new_worth)))}}))}}]),Detail}(p.default.Component);a.default=k},l=e,u=l.webpackJsonp;if(l.webpackJsonp!==u)throw new Error("Prepack model invariant violation: "+l.webpackJsonp);var i=[34],o={1615:a,1826:r,667:n};u(i,o)}).call(this);