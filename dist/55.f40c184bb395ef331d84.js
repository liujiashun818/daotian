(function(){var e=this,t=this,n=function(e,n,a){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,n){if(!(e instanceof n))throw new t.TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new t.ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new t.TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=t.Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(t.Object.setPrototypeOf?t.Object.setPrototypeOf(e,n):e.__proto__=n)}t.Object.defineProperty(n,"__esModule",{value:!0});var r=(a(68),a(67)),l=_interopRequireDefault(r),i=(a(312),a(311)),u=_interopRequireDefault(i),o=(a(49),a(48)),s=_interopRequireDefault(o),c=(a(47),a(41)),f=_interopRequireDefault(c),p=(a(51),a(50)),d=_interopRequireDefault(p),h=(a(66),a(65)),m=_interopRequireDefault(h),y=function(){function defineProperties(e,n){for(var a=0;a<n.length;a++){var r=n[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),t.Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),b=a(0),v=_interopRequireDefault(b),_=a(22),g=_interopRequireDefault(_),E=a(315),k=_interopRequireDefault(E),w=a(2343),C=_interopRequireDefault(w),S=a(1694),O=_interopRequireDefault(S);a(1912);var R=function(e){function List(e){_classCallCheck(this,List);var n=_possibleConstructorReturn(this,(List.__proto__||t.Object.getPrototypeOf(List)).call(this,e));return n.state={superPartList:[],currentId:"",page:1,pid:1,visible:!1,partsId:"",reload:!1},["handleSuperPartClick","handleRowSelect","hideModal","showModal","handleSubmit","handleReload"].map(function(e){return n[e]=n[e].bind(n)}),n}return _inherits(List,e),y(List,[{key:"componentDidMount",value:function(){this.getSuperPartTypeList()}},{key:"handleSuperPartClick",value:function(e,t){this.setState({currentId:t._id,pid:t._id})}},{key:"handleRowSelect",value:function(e){this.setState({partsId:e.join(",")})}},{key:"handleReload",value:function(){this.setState({reload:!0})}},{key:"handleSubmit",value:function(){var e=this;this.props.form.validateFieldsAndScroll(function(n,a){n||(a.markup_rate=t.Number(a.markup_rate)/100,a.part_types=e.state.partsId,g.default.ajax({url:g.default.warehouse.part.partTypeMarkup(),type:"POST",data:a},function(){m.default.success("修改成功！"),e.setState({reload:!0}),e.hideModal()}))})}},{key:"hideModal",value:function(){this.setState({visible:!1}),this.props.form.resetFields()}},{key:"showModal",value:function(){this.setState({visible:!0})}},{key:"getSuperPartTypeList",value:function(){var e=this;g.default.ajax({url:g.default.warehouse.category.superPartTypeList()},function(t){e.setState({superPartList:t.res.list,currentId:t.res.list[0]._id,pid:t.res.list[0]._id})},function(e){m.default.error("获取列表数据失败["+e+"]")})}},{key:"render",value:function(){var e=this,n=this.state,a=n.superPartList,r=n.currentId,i=n.page,o=n.pid,c=n.partsId,p={onChange:this.handleRowSelect};return v.default.createElement(l.default,{style:{marginLeft:"-20px"}},v.default.createElement(s.default,null,v.default.createElement(d.default,{className:"top-category",span:6},v.default.createElement("p",null,"配件分类"),v.default.createElement("ul",null,a.map(function(n){var a=t.Number(n._id)===t.Number(r);return v.default.createElement("li",{className:a?"active":"",key:n._id,onClick:function(){return e.handleSuperPartClick(e,n)}},n.name)}))),v.default.createElement(d.default,{className:"second-category",span:18},v.default.createElement("p",null,v.default.createElement(f.default,{onClick:this.showModal,className:"pull-right mt7 mr10",disabled:!c},"设置加价率")),v.default.createElement("div",null,v.default.createElement(C.default,{rowSelection:p,source:g.default.warehouse.category.partTypeFullList(o,i),page:i,updateState:this.updateState,onSuccess:this.handleReload,reload:this.state.reload})))),v.default.createElement(u.default,{title:"批量设置加价率",visible:this.state.visible,onCancel:this.hideModal,footer:[v.default.createElement(f.default,{key:"buttonSave",type:"primary",onClick:this.handleSubmit},"保存"),v.default.createElement(f.default,{key:"buttonCancel",onClick:this.hideModal},"取消")]},v.default.createElement(s.default,null,v.default.createElement(d.default,{span:20},v.default.createElement(O.default,{id:"markup_rate",label:"加价率",rules:[{required:!0,message:"请输入加价率"}],unit:"%",isInt:!0,self:this})))))}}]),List}(k.default);R=l.default.create()(R),n.default=R},a=function(e,n,a){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,n){if(!(e instanceof n))throw new t.TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new t.ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new t.TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=t.Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(t.Object.setPrototypeOf?t.Object.setPrototypeOf(e,n):e.__proto__=n)}t.Object.defineProperty(n,"__esModule",{value:!0});var r=(a(66),a(65)),l=_interopRequireDefault(r),i=(a(68),a(67)),u=_interopRequireDefault(i),o=t.Object.assign||function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var r in a)t.Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s=function(){function defineProperties(e,n){for(var a=0;a<n.length;a++){var r=n[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),t.Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),c=a(0),f=_interopRequireDefault(c),p=a(9),d=_interopRequireDefault(p),h=u.default.Item,m=function(e){function NumberInput(e){_classCallCheck(this,NumberInput);var n=_possibleConstructorReturn(this,(NumberInput.__proto__||t.Object.getPrototypeOf(NumberInput)).call(this,e));return n.state={unitShow:!1},["handleChange"].map(function(e){return n[e]=n[e].bind(n)}),n}return _inherits(NumberInput,e),s(NumberInput,[{key:"componentDidMount",value:function(){var e=this;t.setTimeout(function(){e.setState({unitShow:!0})},0)}},{key:"handleChange",value:function(e){var n=e.target.value,a=this.props,r=a.id,i=a.onChange,u=a.isInt,o="";if(t.isNaN(n))return l.default.error("只能输入大于零数字"),this[r].value="",i(""),!1;var s=n.split(".")[1];u?(n&&n.indexOf(".")>0&&l.default.warning("只能输入整数"),o=n.replace(/[^\d]/g,""),this[r].value=o):(s&&s.length>2&&l.default.warning("最多只能输入两位小数"),o=n.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),this[r].value=o),!1===i(o)&&(this[r].value="",i(""))}},{key:"render",value:function(){var e=this,n=this.state.unitShow,a=this.props,r=a.defaultValue,l=a.id,i=a.value,u=a.style,s=a.self,c=a.placeholder,p=a.rules,m=a.layout,y=a.label,b=a.unitVisible,v=a.disabled,_=a.unit,g="",E=(0,d.default)({"number-input-addon":b&&n,hide:!b||!n});return s&&(g=s.props.form.getFieldDecorator),s?f.default.createElement("span",{ref:function(t){return e["content"+l]=t},style:u},f.default.createElement(h,o({label:y},m),g(l,{initialValue:t.String(r)||"",validateTrigger:"onBlur",rules:p})(f.default.createElement("input",{className:"ant-input ant-input-lg",ref:function(t){return e[l]=t},onInput:function(t){return e.handleChange(t)},placeholder:c,disabled:v,style:{width:"100%"}})),f.default.createElement("span",{className:E},_||"元"))):f.default.createElement("span",{ref:function(t){return e["content"+l]=t},style:t.Object.assign(u,{display:"inline-block",position:"relative"})},f.default.createElement("input",{value:i,className:"ant-input ant-input-lg",style:{width:"100%"},ref:function(t){return e[l]=t},onInput:function(t){return e.handleChange(t)},placeholder:c,disabled:v}),f.default.createElement("span",{className:E},_||"个"))}}]),NumberInput}(f.default.Component);m.defaultProps={defaultValue:"",style:{width:"100%"},isInt:!1,placeholder:"",rules:"",layout:{labelCol:{span:8},wrapperCol:{span:16}},label:"",unit:"",unitVisible:!0,onChange:function(){}},n.default=m},r=function(e,t,n){t=e.exports=n(14)(),t.push([e.i,".top-category {\n  border-right: none;\n}\n.top-category p {\n  height: 46px;\n  line-height: 46px;\n  color: #333;\n  font-size: 16px;\n  margin-left: 25px;\n}\n.top-category ul {\n  height: 900px;\n  overflow: auto;\n}\n.top-category ul li {\n  width: 100%;\n  height: 40px;\n  line-height: 40px;\n  padding-left: 25px;\n  font-size: 14px;\n  font-weight: 400;\n  font-style: normal;\n  color: #666666;\n}\n.top-category ul li:hover {\n  background-color: #ecf6fd;\n  color: #108ee9;\n}\n.top-category ul li:active {\n  background-color: #ecf6fd;\n  color: #108ee9;\n}\n.top-category ul .active {\n  background-color: #ecf6fd;\n  color: #108ee9;\n  border-right: 3px solid #0f86dd;\n}\n.second-category p {\n  height: 46px;\n  line-height: 46px;\n  margin-left: 5px;\n}\n",""])},l=function(e,t,n){var a=n(1876);"string"==typeof a&&(a=[[e.i,a,""]]);n(15)(a,{});a.locals&&(e.exports=a.locals)},i=function(e,n,a){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,n){if(!(e instanceof n))throw new t.TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new t.ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new t.TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=t.Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(t.Object.setPrototypeOf?t.Object.setPrototypeOf(e,n):e.__proto__=n)}t.Object.defineProperty(n,"__esModule",{value:!0});var r=(a(312),a(311)),l=_interopRequireDefault(r),i=(a(47),a(41)),u=_interopRequireDefault(i),o=(a(202),a(201)),s=_interopRequireDefault(o),c=(a(49),a(48)),f=_interopRequireDefault(c),p=(a(157),a(35)),d=_interopRequireDefault(p),h=(a(51),a(50)),m=_interopRequireDefault(h),y=(a(37),a(59)),b=_interopRequireDefault(y),v=(a(66),a(65)),_=_interopRequireDefault(v),g=(a(68),a(67)),E=_interopRequireDefault(g),k=t.Object.assign||function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var r in a)t.Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},w=function(){function defineProperties(e,n){for(var a=0;a<n.length;a++){var r=n[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),t.Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),C=a(0),S=_interopRequireDefault(C),O=a(9),R=_interopRequireDefault(O),P=a(22),N=_interopRequireDefault(P),q=a(114),T=_interopRequireDefault(q),D=a(116),j=_interopRequireDefault(D),M=a(313),I=_interopRequireDefault(M),x=E.default.Item,L=function(e){function Edit(e){_classCallCheck(this,Edit);var n=_possibleConstructorReturn(this,(Edit.__proto__||t.Object.getPrototypeOf(Edit)).call(this,e));return n.state={visible:!1,item:e.item||{},payMethod:e.item.partTypeConfig?e.item.partTypeConfig.levels:t.JSON.stringify([]),quoteType:e.item.partTypeConfig?e.item.partTypeConfig.quote_type:"0"},["handleQuoteTypeChange","handleAddItemLevel","handleDeleteItemLevel","handleSubmit","handleLevelChange","handlePriceChange"].map(function(e){return n[e]=n[e].bind(n)}),n}return _inherits(Edit,e),w(Edit,[{key:"componentWillReceiveProps",value:function(e){e.item&&this.setState({item:e.item})}},{key:"handleAddItemLevel",value:function(){var e=this.state.payMethod,n="";try{n=t.JSON.parse(e)}catch(e){n=[{name:"",price:""}]}n.push({name:"",price:""}),this.setState({payMethod:t.JSON.stringify(n)})}},{key:"handleDeleteItemLevel",value:function(e){var n=this.state.payMethod,a="";try{a=t.JSON.parse(n)}catch(e){a=[{name:"",price:""}]}a.splice(e,1),0===a.length?(this.setState({payMethod:t.JSON.stringify(a),quoteType:"0"}),this.props.form.setFieldsValue({quote_type:!1})):this.setState({payMethod:t.JSON.stringify(a)})}},{key:"handleQuoteTypeChange",value:function(e){e?this.setState({quoteType:"1",payMethod:t.JSON.stringify([{name:"",price:""}])}):this.setState({quoteType:"0",payMethod:t.JSON.stringify([])})}},{key:"handleLevelChange",value:function(e,n){var a=this.state.payMethod,r="";try{r=t.JSON.parse(a)}catch(e){r=[{name:"",price:""}]}r[n].name=e.target.value,this.setState({payMethod:t.JSON.stringify(r)})}},{key:"handlePriceChange",value:function(e,n){var a=this.state.payMethod,r="";try{r=t.JSON.parse(a)}catch(e){r=[{name:"",price:""}]}r[n].price=e.target.value,this.setState({payMethod:t.JSON.stringify(r)})}},{key:"handleSubmit",value:function(){var e=this,n=this.state,a=n.quoteType,r=n.payMethod;try{var l=!0,i=!1,u=void 0;try{for(var o,s=t.JSON.parse(r)[t.Symbol.iterator]();!(l=(o=s.next()).done);l=!0){var c=o.value;if(!c.name||!c.price)return _.default.warn("配件档次信息未填写完整！"),!1}}catch(e){i=!0,u=e}finally{try{!l&&s.return&&s.return()}finally{if(i)throw u}}}catch(e){}var f=this.props.form.getFieldsValue();f.quote_type=a,f.markup_rate=t.Number(f.markup_rate)/100,"1"===t.String(a)&&(f.levels=r),N.default.ajax({url:N.default.warehouse.part.editPartType(),type:"POST",data:f},function(){e.hideModal(),_.default.success("编辑成功！"),e.props.onSuccess()},function(){_.default.warn("编辑失败！")})}},{key:"render",value:function(){var e=this,n=this.state,a=n.visible,r=n.item,i=n.payMethod,o=n.quoteType,c=T.default.formItemLayout,p=T.default.formItem_618,h=this.props.form.getFieldDecorator,y="";try{y=t.JSON.parse(i)}catch(e){y=[{name:"",price:""}]}var v=y.map(function(t,n){return S.default.createElement(f.default,{key:n+"1"},S.default.createElement(m.default,{span:12},S.default.createElement(x,k({label:"配件档次"},c),S.default.createElement(b.default,{value:t.name,onChange:function(t){return e.handleLevelChange(t,n)}}))),S.default.createElement(m.default,{span:10},S.default.createElement(x,k({label:"报价"},p,{required:!0}),S.default.createElement(b.default,{type:"number",addonAfter:"元",min:0,placeholder:"请输入工时单价",value:t.price,onChange:function(t){return e.handlePriceChange(t,n)},style:{width:"220px"}}))),S.default.createElement(m.default,{span:1,className:"ml10"},S.default.createElement(d.default,{className:"dynamic-delete-button",type:"delete",onClick:function(){return e.handleDeleteItemLevel(n)}})))}),_=(0,R.default)({hide:"0"===t.String(o)});return S.default.createElement("span",null,S.default.createElement("a",{href:"javascript:;",onClick:this.showModal},"编辑"),S.default.createElement(l.default,{title:S.default.createElement("span",null,S.default.createElement(d.default,{type:"edit"})," 编辑配件分类"),visible:a,onCancel:this.hideModal,onOk:this.handleSubmit,width:720},S.default.createElement(E.default,null,h("part_type",{initialValue:r._id})(S.default.createElement(b.default,{type:"hidden"})),S.default.createElement(f.default,null,S.default.createElement(m.default,{span:12},S.default.createElement(x,k({label:"二级分类"},c),S.default.createElement("p",null,r.name))),S.default.createElement(m.default,{span:10},S.default.createElement(x,k({label:"加价率"},p),h("markup_rate",{initialValue:r.partTypeConfig&&t.parseInt(100*t.Number(r.partTypeConfig.markup_rate),10),rules:j.default.getRulePartNo(),validateTrigger:"onBlur"})(S.default.createElement(b.default,{placeholder:"请输入加价率",addonAfter:"%",style:{width:"221px"}}))))),S.default.createElement(f.default,null,S.default.createElement(m.default,{span:12},S.default.createElement(x,k({label:"预设报价"},c),h("quote_type",{valuePropName:"checked",initialValue:"0"!==t.String(o),onChange:this.handleQuoteTypeChange})(S.default.createElement(s.default,{checkedChildren:"启用",unCheckedChildren:"停用"}))))),S.default.createElement("div",{className:_},v,S.default.createElement(f.default,null,S.default.createElement(m.default,{span:24,className:"center"},S.default.createElement(u.default,{type:"dashed",onClick:this.handleAddItemLevel,className:"ml3 font-size-13 mt5 mb5",style:{width:"95%",color:"#333",marginLeft:"-1%"}},S.default.createElement(d.default,{type:"plus"})," 添加项目档次")))))))}}]),Edit}(I.default);L=E.default.create()(L),n.default=L},u=function(e,n,a){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,n){if(!(e instanceof n))throw new t.TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new t.ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new t.TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=t.Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(t.Object.setPrototypeOf?t.Object.setPrototypeOf(e,n):e.__proto__=n)}t.Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function defineProperties(e,n){for(var a=0;a<n.length;a++){var r=n[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),t.Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),l=a(0),i=_interopRequireDefault(l),u=a(316),o=_interopRequireDefault(u),s=a(198),c=_interopRequireDefault(s),f=a(2342),p=_interopRequireDefault(f),d=function(e){function Table(){return _classCallCheck(this,Table),_possibleConstructorReturn(this,(Table.__proto__||t.Object.getPrototypeOf(Table)).apply(this,arguments))}return _inherits(Table,e),r(Table,[{key:"renderTable",value:function(e){var t=this.state,n=t.isFetching,a=t.list,r=t.total,l=this.props.rowSelection;return i.default.createElement(c.default,{rowSelection:l,isLoading:n,columns:e,dataSource:a,total:r,currentPage:this.props.page,onPageChange:this.handlePageChange,pageSize:30,bordered:!1,scroll:{y:785}})}},{key:"render",value:function(){var e=this,n=[{title:"二级分类",dataIndex:"name",key:"name",width:"20%"},{title:"加价率%",dataIndex:"partTypeConfig",key:"markup_rate",className:"center",width:"20%",render:function(e){return e?(100*t.Number(e.markup_rate)).toFixed(0):"--"}},{title:"档次",dataIndex:"partTypeConfig",key:"levels",className:"center",width:"20%",render:function(e){var n=[];if(e&&e.levels.length>0){t.JSON.parse(e.levels).map(function(t,a){n.push(i.default.createElement("div",{className:"in-table-line",key:e._id+"-"+a},t.name))})}else n="现场报价";return n}},{title:"报价",dataIndex:"partTypeConfig",key:"price",className:"center",width:"20%",render:function(e){var n=[];if(e&&e.levels.length>0){t.JSON.parse(e.levels).map(function(a,r){n.push(i.default.createElement("div",{className:"in-table-line",key:e._id+"-"+r},t.Number(a.price).toFixed(2)))})}else n="--";return n}},{title:"操作",key:"handle",className:"center",width:"20%",render:function(t,n){return i.default.createElement(p.default,{item:n,onSuccess:e.props.onSuccess})}}];return this.renderTable(n)}}]),Table}(o.default);n.default=d},o=e,s=o.webpackJsonp;if(o.webpackJsonp!==s)throw new Error("Prepack model invariant violation: "+o.webpackJsonp);var c=[55],f={1580:n,1694:a,1876:r,1912:l,2342:i,2343:u};s(c,f)}).call(this);